<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Worker</title>
<script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="{{static_url('js/Chart.min.js')}}">
  var Chartjs = Chart.noConflict()
</script>
<script>
	$(document).ready(function(){
		$.ajax({
			url: window.location.pathname,
			type: 'POST',
			contentType: 'application/json',
			success: function(data){
				var runtimeLabels = [], sumLabels = [], 
					  cpuPct = [], memPct = [], 
					  readCount = [], writeCount = [], 
					  readBytes = [], writeBytes = [], 
					  runtime = [], 
					  readRates = [], writeRates = [],
					  totalReadBytes = [], totalWriteBytes = [],
					  totalReadCount = [], totalWriteCount = [],
					  avgCpuPct = [], avgMemPct = [];
				for(i = 0; i < data.length; i ++){
					if(data[i].status == 'terminated'){
						runtimeLabels[runtimeLabels.length - 1] = data[i].executable;
						sumLabels.push(data[i].executable);
						runtime.push(data[i].runtime);
						avgCpuPct.push(data[i].avg_cpu_percent);
						avgMemPct.push(data[i].avg_mem_percent);
						//readRates.push(data[i].read_rate);
						//writeRates.push(data[i].write_rate);
						totalReadCount.push(data[i].total_read_count);
						totalWriteCount.push(data[i].total_write_count);
						totalReadBytes.push(data[i].total_read_bytes)	;
						totalWriteBytes.push(data[i].total_write_bytes);
					}
					else{
						runtimeLabels.push('');
						cpuPct.push(data[i].cpu_percent);
						memPct.push(data[i].memory_percent);
						readCount.push(data[i].total_read_count);
						writeCount.push(data[i].total_write_count);
						readBytes.push(data[i].total_read_bytes);
						writeBytes.push(data[i].total_write_bytes);
					}
				}
				var cpuMemChart = new Chart($('#cpu_mem_pct').get(0).getContext('2d')),
					   ioCountChart = new Chart($('#io_count').get(0).getContext('2d')),
					   ioBytesChart = new Chart($('#io_bytes').get(0).getContext('2d')),
					   sumCpuMemChart = new Chart($('#sum_cpu_mem_pct').get(0).getContext('2d')),
					   sumRwCountChart = new Chart($('#sum_rw_count').get(0).getContext('2d')),
					   sumRwBytesChart = new Chart($('#sum_rw_bytes').get(0).getContext('2d')),
					   sumRuntimeChart = new Chart($('#sum_runtime').get(0).getContext('2d'));
				
				var cpuMemData = {
					    labels: runtimeLabels,
					    datasets: [
					        {
					            label: "CPU Percentage",
					            fillColor: "rgba(151,187,205,0.2)",
					            strokeColor: "rgba(151,187,205,1)",
					            pointColor: "rgba(151,187,205,1)",
					            pointStrokeColor: "#fff",
					            pointHighlightFill: "#fff",
					            pointHighlightStroke: "rgba(151,187,205,1)",
					            data: cpuPct
					        },
					        {
					            label: "Memory Percentage",
					            fillColor: "rgba(220,220,220,0.2)",
					            strokeColor: "rgba(220,220,220,1)",
					            pointColor: "rgba(220,220,220,1)",
					            pointStrokeColor: "#fff",
					            pointHighlightFill: "#fff",
					            pointHighlightStroke: "rgba(220,220,220,1)",
					            data: memPct
					        },
					    ]
					},
					ioCountData = {
					    labels: runtimeLabels,
					    datasets: [
					        {
					            label: "Read Count",
					            fillColor: "rgba(151,187,205,0.2)",
					            strokeColor: "rgba(151,187,205,1)",
					            pointColor: "rgba(151,187,205,1)",
					            pointStrokeColor: "#fff",
					            pointHighlightFill: "#fff",
					            pointHighlightStroke: "rgba(151,187,205,1)",
					            data: readCount
					        },
					        {
					            label: "Write Count",
					            fillColor: "rgba(220,220,220,0.2)",
					            strokeColor: "rgba(220,220,220,1)",
					            pointColor: "rgba(220,220,220,1)",
					            pointStrokeColor: "#fff",
					            pointHighlightFill: "#fff",
					            pointHighlightStroke: "rgba(220,220,220,1)",
					            data: writeCount
					        },
					    ]
					},
					ioBytesData = {
						    labels: runtimeLabels,
						    datasets: [
						        {
						            label: "Read Count",
						            fillColor: "rgba(151,187,205,0.2)",
						            strokeColor: "rgba(151,187,205,1)",
						            pointColor: "rgba(151,187,205,1)",
						            pointStrokeColor: "#fff",
						            pointHighlightFill: "#fff",
						            pointHighlightStroke: "rgba(151,187,205,1)",
						            data: readBytes
						        },
						        {
						            label: "Write Count",
						            fillColor: "rgba(220,220,220,0.2)",
						            strokeColor: "rgba(220,220,220,1)",
						            pointColor: "rgba(220,220,220,1)",
						            pointStrokeColor: "#fff",
						            pointHighlightFill: "#fff",
						            pointHighlightStroke: "rgba(220,220,220,1)",
						            data: writeBytes
						        },
						    ]
					},
					sumCpuMemData = {
						labels: sumLabels,
						datasets: [
				                   {
				                       label: "Avg. CPU Usage",
				                       fillColor: "rgba(220,220,220,0.5)",
				                       strokeColor: "rgba(220,220,220,0.8)",
				                       highlightFill: "rgba(220,220,220,0.75)",
				                       highlightStroke: "rgba(220,220,220,1)",
				                       data: avgCpuPct
				                   },
				                   {
				                       label: "Avg. Memory Usage",
				                       fillColor: "rgba(41,23,25,0.15)",
				                       strokeColor: "rgba(1,7,23,0.28)",
				                       highlightFill: "rgba(123,147,25,75)",
				                       highlightStroke: "rgba(15,18,25,111)",
				                       data: avgMemPct
				                   }
						]
					},	
					sumRwCountData = {
						labels: sumLabels,
						datasets: [
				                   {
				                       label: "Read Count",
				                       fillColor: "rgba(41,23,25,0.15)",
				                       strokeColor: "rgba(1,7,23,0.28)",
				                       highlightFill: "rgba(123,147,25,75)",
				                       highlightStroke: "rgba(15,18,25,111)",
				                       data: totalReadCount
				                   },
				                   {
				                       label: "Write Count",
				                       fillColor: "rgba(12,17,2,0.5)",
				                       strokeColor: "rgba(111,17,20,8)",
				                       highlightFill: "rgba(113,112,25,75)",
				                       highlightStroke: "rgba(1,17,210,123)",
				                       data: totalWriteCount
				                   }
						]
					},
					sumRwBytesData = {
						labels: sumLabels,
						datasets:[
				                   {
				                       label: "Read Bytes",
				                       fillColor: "rgba(151,187,205,0.5)",
				                       strokeColor: "rgba(151,187,205,0.8)",
				                       highlightFill: "rgba(151,187,205,0.75)",
				                       highlightStroke: "rgba(151,187,205,1)",
				                       data: totalReadBytes
				                   },
				                   {
				                       label: "Write Bytes",
				                       fillColor: "rgba(151,167,205,1.5)",
				                       strokeColor: "rgba(151,111,205,12.8)",
				                       highlightFill: "rgba(151,17,205,6.75)",
				                       highlightStroke: "rgba(11,87,25,156)",
				                       data: totalWriteBytes
				                   }
						]
					},
					sumRuntimeData = {
						    labels: sumLabels,
						    datasets: [
					                   {
					                       label: "Runtime",
					                       fillColor: "rgba(220,220,220,0.5)",
					                       strokeColor: "rgba(220,220,220,0.8)",
					                       highlightFill: "rgba(220,220,220,0.75)",
					                       highlightStroke: "rgba(220,220,220,1)",
					                       data: runtime
					                   }
						    ]
					};
				
				var cpuMemLine = cpuMemChart.Line(cpuMemData, {bezierCurve: false});
				var ioCountLine = ioCountChart.Line(ioCountData, {bezierCurve: false});
				var ioBytesLine = ioBytesChart.Line(ioBytesData, {bezierCurve: false});
				var sumCpuMemLine = sumCpuMemChart.Bar(sumCpuMemData, {barShowStroke: false});
				var sumRwCountLine = sumRwCountLine.Bar(sumRwCountData, {barShowStroke: false});
				var sumRwBytesLine = sumRwBytesLine.Bar(sumRwBytesData, {barShowStroke: false});
				var sumRuntimeLine = sumRuntimeLine.Bar(sumRuntimeData, {barShowStroke: false});
			}
		});
	});
</script>
</head>
<body>
<canvas id="cpu_mem_pct" width="1500" height="500"></canvas>
<canvas id="io_count" width="1500" height="500"></canvas>
<canvas id="io_bytes" width="1500" height="500"></canvas>
<canvas id="sum_runtime" width="1500" height="500"></canvas>
<canvas id="sum_cpu_mem_pct" width="1500" height="500"></canvas>
<canvas id="sum_rw_count" width="1500" height="500"></canvas>
<canvas id="sum_rw_bytes" width="1500" height="500"></canvas>
</body>
</html>