<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Worker</title>
<script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="{{static_url('js/Chart.min.js')}}">
  var Chartjs = Chart.noConflict()
</script>
<script>
	$(document).ready(function(){
		$.ajax({
			url: window.location.pathname,
			type: 'POST',
			contentType: 'application/json',
			success: function(data){
				var labels = [], nums = [];
				for(i = 0; i < data.length; i ++){
					var labels = [], cpu_pct = [], mem_pct = [];
					if(data[i].status == 'terminated'){
						labels.push(data[i].executable);
						cpu_pct.push(data[i].avg_cpu_percent);
						mem_pct.push(data[i].avg_mem_percent);
					}
					else{
						labels.push('');
						cpu_pct.push(data[i].cpu_percent);
						mem_pct.push(data[i].memory_percent);
					}
				}
				var cpuMemChart = new Chart($('#cpu_mem_pct').get(0).getContext("2d"));
				var cpu_data = {
					    labels: labels,
					    datasets: [
					        {
					            label: "CPU Percentage",
					            fillColor: "rgba(151,187,205,0.2)",
					            strokeColor: "rgba(151,187,205,1)",
					            pointColor: "rgba(151,187,205,1)",
					            pointStrokeColor: "#fff",
					            pointHighlightFill: "#fff",
					            pointHighlightStroke: "rgba(151,187,205,1)",
					            data: cpu_pct
					        },
					        {
					            label: "My First dataset",
					            fillColor: "rgba(220,220,220,0.2)",
					            strokeColor: "rgba(220,220,220,1)",
					            pointColor: "rgba(220,220,220,1)",
					            pointStrokeColor: "#fff",
					            pointHighlightFill: "#fff",
					            pointHighlightStroke: "rgba(220,220,220,1)",
					            data: mem_pct
					        },
					    ]
					};
				var cpuMemLineChart = cpuMemChart.Line(cpu_data, {bezierCurve: true});
			}
		});
	});
</script>
</head>
<body>
<canvas id="cpu_mem_pct" width="1000" height="500"></canvas>
</body>
</html>